# ğŸ”„ System Workflow - Speech-to-Text Complaint System

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER OPENS WEB APPLICATION                       â”‚
â”‚                     http://localhost:3000                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: RECORD AUDIO                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ Click "Start Recording" button                            â”‚  â”‚
â”‚  â”‚  â€¢ Browser requests microphone permission                    â”‚  â”‚
â”‚  â”‚  â€¢ User speaks complaint in Tamil or English                 â”‚  â”‚
â”‚  â”‚  â€¢ Recording timer shows elapsed time                        â”‚  â”‚
â”‚  â”‚  â€¢ Click "Stop Recording" when done                          â”‚  â”‚
â”‚  â”‚  â€¢ Audio preview available for playback                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Component: AudioRecorder.tsx                                       â”‚
â”‚  Technology: MediaRecorder API                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: SPEECH-TO-TEXT CONVERSION                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React)                                             â”‚  â”‚
â”‚  â”‚  â€¢ User clicks "Convert to Text"                             â”‚  â”‚
â”‚  â”‚  â€¢ Audio blob sent as FormData                               â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€> POST /api/speech-to-text                               â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Backend (API Route)                                          â”‚  â”‚
â”‚  â”‚  1. Receive audio file (WebM format)                         â”‚  â”‚
â”‚  â”‚  2. Save temporarily to uploads/                             â”‚  â”‚
â”‚  â”‚  3. Convert to WAV using FFmpeg:                             â”‚  â”‚
â”‚  â”‚     ffmpeg -i input.webm -ar 16000 -ac 1 output.wav         â”‚  â”‚
â”‚  â”‚  4. Speech Recognition:                                       â”‚  â”‚
â”‚  â”‚     â€¢ Try Tamil first (ta-IN)                                â”‚  â”‚
â”‚  â”‚     â€¢ Fallback to English (en-IN)                            â”‚  â”‚
â”‚  â”‚  5. Return transcribed text + detected language              â”‚  â”‚
â”‚  â”‚  6. Clean up temporary files                                 â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Response:                                                     â”‚  â”‚
â”‚  â”‚  { success: true, text: "...", language: "ta" }             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Component: TranscriptionDisplay.tsx                                â”‚
â”‚  API: /api/speech-to-text/route.ts                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: AI-POWERED COMPLAINT GENERATION âœ¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React)                                             â”‚  â”‚
â”‚  â”‚  â€¢ Display transcribed text with language badge              â”‚  â”‚
â”‚  â”‚  â€¢ User clicks "Generate Complaint Letter with AI"           â”‚  â”‚
â”‚  â”‚  â€¢ Send text + language to backend                           â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€> POST /api/generate-complaint                           â”‚  â”‚
â”‚  â”‚        Body: { text: "...", language: "ta" }                 â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Backend - AI Agent (AIComplaintGenerator)                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  1. Build AI Prompt:                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     "Based on this Tamil complaint: [text]             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      Generate a professional complaint letter..."       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. Call Claude 3.5 Sonnet API:                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Model: claude-3-5-sonnet-20241022                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Max tokens: 2048                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Temperature: default                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. AI Analyzes Complaint:                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     âœ“ Identifies category (Water, Road, etc.)          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     âœ“ Structures professional letter                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     âœ“ Adds proper greeting/closing                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     âœ“ Formats in correct language                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     âœ“ Includes relevant details                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. Format Response:                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Add complaint ID header                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Add timestamp                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Add status footer                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  5. Fallback (if AI fails):                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Use template-based generation                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â€¢ Still professional format                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Response:                                                     â”‚  â”‚
â”‚  â”‚  {                                                             â”‚  â”‚
â”‚  â”‚    success: true,                                              â”‚  â”‚
â”‚  â”‚    complaint: "â•â•â• COMPLAINT LETTER â•â•â•\n...",               â”‚  â”‚
â”‚  â”‚    category: "Water Supply",                                  â”‚  â”‚
â”‚  â”‚    details: { ... }                                            â”‚  â”‚
â”‚  â”‚  }                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Component: ComplaintDisplay.tsx                                    â”‚
â”‚  API: /api/generate-complaint/route.ts                             â”‚
â”‚  AI: lib/ai-complaint-generator.ts                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: VERIFICATION WITH TEXT-TO-SPEECH                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React)                                             â”‚  â”‚
â”‚  â”‚  â€¢ Display AI-generated complaint letter                     â”‚  â”‚
â”‚  â”‚  â€¢ User reviews the content                                  â”‚  â”‚
â”‚  â”‚  â€¢ User clicks "Listen to Complaint"                         â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€> POST /api/text-to-speech                               â”‚  â”‚
â”‚  â”‚        Body: { text: "...", language: "ta" }                 â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Backend (TTS Processing)                                     â”‚  â”‚
â”‚  â”‚  1. Receive complaint text + language                        â”‚  â”‚
â”‚  â”‚  2. Use gTTS (Google Text-to-Speech):                        â”‚  â”‚
â”‚  â”‚     â€¢ Tamil: lang='ta'                                        â”‚  â”‚
â”‚  â”‚     â€¢ English: lang='en'                                      â”‚  â”‚
â”‚  â”‚  3. Generate MP3 audio file                                  â”‚  â”‚
â”‚  â”‚  4. Save to public/audio/                                    â”‚  â”‚
â”‚  â”‚  5. Return audio file URL                                    â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Frontend (Audio Playback)                                    â”‚  â”‚
â”‚  â”‚  â€¢ Receive audio URL                                         â”‚  â”‚
â”‚  â”‚  â€¢ Display audio player                                      â”‚  â”‚
â”‚  â”‚  â€¢ Auto-play complaint for verification                      â”‚  â”‚
â”‚  â”‚  â€¢ User can replay or proceed                                â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Verification Options:                                        â”‚  â”‚
â”‚  â”‚  [âœ… Confirm & Submit]  [ğŸ”„ Record Again]                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Component: VerificationSection.tsx                                 â”‚
â”‚  API: /api/text-to-speech/route.ts                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: SUBMIT AND STORE COMPLAINT                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React)                                             â”‚  â”‚
â”‚  â”‚  â€¢ User clicks "Confirm & Submit"                            â”‚  â”‚
â”‚  â”‚  â€¢ Prepare complaint data                                    â”‚  â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€> POST /api/complaints                                   â”‚  â”‚
â”‚  â”‚        Body: {                                                â”‚  â”‚
â”‚  â”‚          complaint: "...",                                    â”‚  â”‚
â”‚  â”‚          transcribed_text: "...",                             â”‚  â”‚
â”‚  â”‚          language: "ta",                                      â”‚  â”‚
â”‚  â”‚          category: "Water Supply"                             â”‚  â”‚
â”‚  â”‚        }                                                       â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Backend - Database Storage (ComplaintDB)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  1. Generate Unique ID:                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     ID: CMP{timestamp}{random}                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     Example: CMP7K3L9XYZ                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. Insert into SQLite Database:                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     INSERT INTO complaints (                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       id,                    -- CMP7K3L9XYZ             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       complaint_text,        -- Full letter             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       transcribed_text,      -- Original speech         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       language,              -- ta or en                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       category,              -- Water Supply            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       status,                -- submitted               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       created_at,            -- 2026-01-07 10:30:00    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       updated_at             -- 2026-01-07 10:30:00    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     ) VALUES (...)                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. Commit Transaction                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. Return Success + Complaint ID                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Response:                                                     â”‚  â”‚
â”‚  â”‚  {                                                             â”‚  â”‚
â”‚  â”‚    success: true,                                              â”‚  â”‚
â”‚  â”‚    complaint_id: "CMP7K3L9XYZ",                               â”‚  â”‚
â”‚  â”‚    message: "Complaint submitted successfully"                â”‚  â”‚
â”‚  â”‚  }                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Database: lib/database.ts                                          â”‚
â”‚  API: /api/complaints/route.ts                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUCCESS SCREEN                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚              âœ… COMPLAINT REGISTERED SUCCESSFULLY!            â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚               Your Complaint ID: CMP7K3L9XYZ                  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  What happens next:                                           â”‚  â”‚
â”‚  â”‚  â€¢ Complaint saved to database                                â”‚  â”‚
â”‚  â”‚  â€¢ Will be reviewed by appropriate department                â”‚  â”‚
â”‚  â”‚  â€¢ Use Complaint ID to track status                          â”‚  â”‚
â”‚  â”‚  â€¢ You may be contacted for additional info                  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚           [â• Register New Complaint]                         â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  Component: SuccessMessage.tsx                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## Technology Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (React)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP Requests
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js Server    â”‚
â”‚   (API Routes)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€> FFmpeg (Audio Conversion)
       â”‚
       â”œâ”€â”€> Speech Recognition API
       â”‚
       â”œâ”€â”€> Anthropic Claude API (AI)
       â”‚
       â”œâ”€â”€> gTTS (Text-to-Speech)
       â”‚
       â””â”€â”€> SQLite Database
```

## Data Flow Diagram

```
 Audio Blob         Transcribed      AI-Generated      Verified        Stored
  (WebM)      â†’       Text      â†’    Complaint    â†’   Complaint   â†’   Database
                                       Letter

   [ğŸ¤]      â†’       [ğŸ“]      â†’      [âœ¨]        â†’     [âœ…]      â†’    [ğŸ’¾]
                                                                     
MediaRecorder   Speech-to-Text    Claude AI        TTS + Review    SQLite DB
   API           (Google)         Sonnet 3.5       (gTTS)         complaints
                                                                    table
```

## Component Interaction

```
page.tsx (Main Controller)
    â”‚
    â”œâ”€â”€ AudioRecorder
    â”‚       â””â”€â”€ MediaRecorder API
    â”‚
    â”œâ”€â”€ TranscriptionDisplay
    â”‚       â””â”€â”€ /api/speech-to-text
    â”‚               â””â”€â”€ FFmpeg + Speech Recognition
    â”‚
    â”œâ”€â”€ ComplaintDisplay
    â”‚       â””â”€â”€ /api/generate-complaint
    â”‚               â””â”€â”€ AIComplaintGenerator
    â”‚                       â””â”€â”€ Anthropic Claude API
    â”‚
    â”œâ”€â”€ VerificationSection
    â”‚       â””â”€â”€ /api/text-to-speech
    â”‚               â””â”€â”€ gTTS
    â”‚       â””â”€â”€ /api/complaints (Submit)
    â”‚               â””â”€â”€ ComplaintDB
    â”‚                       â””â”€â”€ SQLite
    â”‚
    â””â”€â”€ SuccessMessage
            â””â”€â”€ Display Complaint ID
```

## State Management Flow

```
Step 1: audioBlob = null
            â†“ (record audio)
Step 2: audioBlob = Blob (WebM)
            â†“ (convert to text)
Step 3: transcribedText = "..." + detectedLanguage = "ta"
            â†“ (generate complaint)
Step 4: complaintText = "..." + category = "Water Supply"
            â†“ (verify with TTS)
Step 5: User confirms
            â†“ (submit)
Step 6: complaintId = "CMP7K3L9XYZ"
            â†“
        SUCCESS!
```

## Error Handling Flow

```
Each Step Has Error Handling:
    â”‚
    â”œâ”€â”€ Microphone Access Denied
    â”‚   â””â”€â”€ Show error message + request permission
    â”‚
    â”œâ”€â”€ Speech Recognition Failed
    â”‚   â””â”€â”€ Retry with alternative language
    â”‚
    â”œâ”€â”€ AI Generation Failed
    â”‚   â””â”€â”€ Fallback to template generation
    â”‚
    â”œâ”€â”€ TTS Failed
    â”‚   â””â”€â”€ Skip audio, allow text review only
    â”‚
    â””â”€â”€ Database Error
        â””â”€â”€ Show error + allow retry
```

---

**This workflow ensures a smooth, user-friendly experience from recording to submission!**
